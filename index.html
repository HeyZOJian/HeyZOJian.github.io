<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>Hexo</title>
  <meta name="author" content="John Doe">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Hexo"/>

  
    <meta property="og:image" content="undefined"/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-70812759-1', 'auto');
  ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?9fe8cb2deab9dc59dccf858801029c7e";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Hexo</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="page-header logo">
  <h1>Hexo<span class="blink-fast">∎</span></h1>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">
      <i class="fa fa-heart blink-slow"></i>
      つよくなりたい
</div>    
		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/02/08/Django-REST-framework-教程2：请求和响应/" >Django REST framework 教程2：请求和响应</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-02-08  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p>这一篇我们开始讲解RESTframework框架的核心内容。让我们介绍一些基本的构建模块。<br>
	
	</div>
  <a type="button" href="/2018/02/08/Django-REST-framework-教程2：请求和响应/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/02/07/Django-RESTful-framework教程1：序列化/" >Django REST framework教程1：序列化</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-02-07  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>这个教程将创建一套简单的代码高亮的pastebin的Web API。一路上我们会介绍许多构建<code>REST frmaework</code>的组件，并且让你有一个全面的认识，这些组件是如何组建在一起的。<br>
	
	</div>
  <a type="button" href="/2018/02/07/Django-RESTful-framework教程1：序列化/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/02/06/Django-RESTful-framework快速入门/" >Django RESTful framework快速入门</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-02-06  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h1 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h1><p>我们会创建一套简单的API来允许管理员查看和编辑系统中的用户和用户组<br>
	
	</div>
  <a type="button" href="/2018/02/06/Django-RESTful-framework快速入门/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/01/07/数据库建模/" >数据库建模</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-01-07  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="一-数据库设计过程"><a href="#一-数据库设计过程" class="headerlink" title="一.数据库设计过程"></a>一.数据库设计过程</h2>
	
	</div>
  <a type="button" href="/2018/01/07/数据库建模/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/05/21/乐观锁-悲观锁/" >乐观锁-悲观锁</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-05-21  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<a id="more"></a>
<h2 id="悲观锁"><a href="#悲观锁" class="headerlink" title="悲观锁"></a>悲观锁</h2><p>对数据被外界修改持保守态度，在整个数据处理过程中，将数据处于<strong>锁定状态</strong>。其实现依靠数据库的锁机制，以保证操作最大程度的独占性。但随之而来的就是数据库性能的大量开销。<br>以<strong>MySQL InnoDB</strong>为例,当使用<code>SELECT FOR UPDATE</code>就会使用悲观锁，前提是把事务自动提交取消<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">set</span> autocommit = <span class="number">0</span>;</div></pre></td></tr></table></figure></p>
<p>使用悲观锁的原理就是，当我们在查询出信息后就把当前的数据锁定，直到我们修改完毕后再解锁。<br>根据查询条件的不同，锁定的范围也不同</p>
<ol>
<li>当查询条件中<strong>指定明确主键</strong>，并且有此数据——–行级锁（row lock）</li>
<li>当查询条件中<strong>指定明确主键</strong>，但无次数据———-无锁</li>
<li>当查询条件中<strong>无主键</strong>————————-表级锁（table lock）</li>
<li>当查询条件中<strong>主键不明确</strong>———————-表级锁（table lock）</li>
</ol>
<h2 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h2><p>乐观锁大多基于<strong>数据版本记录机制</strong>实现，即为数据增加一个版本标识，在基于数据库表的版本解决方案，一般是通过为数据库表增加一个 “version” 字段来实现。也可以采用另一种方式，同样是在需要乐观锁控制的table中增加一个字段，名称无所谓，字段类型使用时间戳timestamp中，<br><strong>操作步骤</strong></p>
<ol>
<li>读取出数据时，将此版本号（时间戳）一同读出</li>
<li>更新时，比较数据库中该数据当前的版本号和手上的版本号，不一致说明版本冲突，一致则OK，将版本号+1或者获取当前时间戳后将数据更新回数据库</li>
</ol>
<p><strong>缺点</strong><br>乐观锁机制往往基于系统中的数据存储逻辑，那么来自外部系统的更新操作不受我们系统的控制，因此可能会造成脏数据被更新到数据库中。<br><strong>解决</strong><br>如将乐观锁策略在数据库存储过程中实现，对外只开放基于此存储过程的数据更新途径，而不是将数据库表直接对外公开</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.36nu.com/post/162.html" target="_blank" rel="external">muyuren | mysql悲观锁详解</a></p>
<p><a href="https://www.36nu.com/post/163.html" target="_blank" rel="external">muyuren | mysql乐观锁详解</a></p>

	
	</div>
  <a type="button" href="/2017/05/21/乐观锁-悲观锁/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/05/10/Hibernate-NotNull-NotEmpty-NotBlank区别/" >Hibernate NotNull NotEmpty NotBlank区别</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-05-10  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="NotNull"><a href="#NotNull" class="headerlink" title="@NotNull"></a>@NotNull</h2><p>不允许为null，但可以是empty</p>
<h2 id="NotEmpty"><a href="#NotEmpty" class="headerlink" title="@NotEmpty"></a>@NotEmpty</h2><p>不允许为null且长度要大于0</p>
<h2 id="NotBlank"><a href="#NotBlank" class="headerlink" title="@NotBlank"></a>@NotBlank</h2><p>只能作用在String上，不能为null，而且调用trim()后，长度必须大于0</p>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">String name = <span class="keyword">null</span>;</div><div class="line">NotNull = <span class="keyword">false</span></div><div class="line">NotEmpty = <span class="keyword">false</span></div><div class="line">NotBlank = <span class="keyword">false</span></div><div class="line"></div><div class="line">String nam = <span class="string">""</span>;</div><div class="line">NotNull = <span class="keyword">true</span></div><div class="line">NotEmpty = <span class="keyword">false</span></div><div class="line">NotBlank = <span class="keyword">false</span></div><div class="line"></div><div class="line">String name = <span class="string">"  "</span>;</div><div class="line">NotNull = <span class="keyword">true</span></div><div class="line">NotEmpty = <span class="keyword">true</span></div><div class="line">NotBlank = <span class="keyword">false</span></div><div class="line"></div><div class="line">String name = <span class="string">"zojian"</span></div><div class="line">NotNull = <span class="keyword">true</span></div><div class="line">NotEmpty = <span class="keyword">true</span></div><div class="line">NotBlank = <span class="keyword">true</span></div></pre></td></tr></table></figure>

	
	</div>
  <a type="button" href="/2017/05/10/Hibernate-NotNull-NotEmpty-NotBlank区别/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/05/09/Spring4注入properties文件方式/" >Spring4基于注解加载properties文件方式</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-05-09  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="PropertySource注解"><a href="#PropertySource注解" class="headerlink" title="@PropertySource注解"></a>@PropertySource注解</h2><p>将properties配置文件中的值存储到Spring的 Environment中，Environment接口提供方法去读取配置文件中的值，参数是properties文件中定义的key值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@PropertySource</span>(<span class="string">"classpath:message.properties"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</div><div class="line">	<span class="comment">//something</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="多个配置文件-PropertySources注解"><a href="#多个配置文件-PropertySources注解" class="headerlink" title="多个配置文件@PropertySources注解"></a>多个配置文件@PropertySources注解</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@PropertySources</span>(&#123;</div><div class="line">	<span class="meta">@PropertySource</span>(<span class="string">"classpath:config.properties"</span>),</div><div class="line">	<span class="meta">@PropertySource</span>(<span class="string">"classpath:db.properties"</span>)</div><div class="line">&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</div><div class="line">	<span class="comment">//something</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="ignoreResourceNotFound属性"><a href="#ignoreResourceNotFound属性" class="headerlink" title="ignoreResourceNotFound属性"></a>ignoreResourceNotFound属性</h2><p>如果<em>*</em>.properties不存在或找不到,系统则会抛出异常FileNotFoundException。<br>但是ignoreResourceNotFound设为true之后会忽略找不到的文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@PropertySource</span>(value=<span class="string">"classpath:missing.properties"</span></div><div class="line">					  ,ignoreResourceNotFound=<span class="keyword">true</span>)</div><div class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</div><div class="line">		<span class="comment">//something</span></div><div class="line">	&#125;</div></pre></td></tr></table></figure>

	
	</div>
  <a type="button" href="/2017/05/09/Spring4注入properties文件方式/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/05/06/Java并发编程的艺术笔记/" >[读薄系列]Java并发编程的艺术笔记</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-05-06  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
           
              <div class="thumbnail"><a href="/2017/05/06/Java并发编程的艺术笔记/"><img src="http://okc9ihakz.bkt.clouddn.com/caspar-rubin-224229.jpg?slimimage" alt="[读薄系列]Java并发编程的艺术笔记"  class="nofancybox"></a>
           
		</div>
	
	
		<h1 id="1-并发编程的挑战"><a href="#1-并发编程的挑战" class="headerlink" title="1.并发编程的挑战"></a>1.并发编程的挑战</h1><h2 id="什么是上下文切换"><a href="#什么是上下文切换" class="headerlink" title="什么是上下文切换"></a>什么是上下文切换</h2><p>CPU通过时间片分配算法循环执行任务[线程]，当任务执行完一个时间片后会切换到下一个任务，在切换前会保存上一个任务的状态，以便下次切换回来时可以再加载这个任务的状态。所以任务从<strong>保存</strong>到<strong>加载</strong>的过程就是一次上下文切换。</p>
<h2 id="如何减少上下文切换"><a href="#如何减少上下文切换" class="headerlink" title="如何减少上下文切换"></a>如何减少上下文切换</h2><ol>
<li>无锁并发编程：如数据取模分段，不同线程处理不同数据</li>
<li>CAS算法：Atomic包使用CAS算法来更新数据， 而不需要加锁</li>
<li>使用最少线程：避免创建不必要的线程，使得大多数线程处于等待状态</li>
<li>协程：在单线程里实现多任务调度，并在单线程里维持多个任务的切换</li>
</ol>
<h2 id="如何避免死锁"><a href="#如何避免死锁" class="headerlink" title="如何避免死锁"></a>如何避免死锁</h2><ol>
<li>避免一个线程同时获得多个锁</li>
<li>避免一个锁同时占用多个资源</li>
<li>限制加锁顺序</li>
<li>尝试使用定时锁 lock.tryLock(timeout)</li>
<li>对应数据库锁，加锁和解锁必须在同一个数据库连接里</li>
</ol>
<h1 id="2-Java并发机制底层实现原理"><a href="#2-Java并发机制底层实现原理" class="headerlink" title="2.Java并发机制底层实现原理"></a>2.Java并发机制底层实现原理</h1><h2 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h2><blockquote>
<p>轻量级的synchronized，在多处理器开发中保证了共享变量的“可见性”（当一个线程修改一个共享变量时，另一个线程能读到这个修改的值）<br>比synchronized的使用和执行成本低，因为它不会引起线程上下文的切换和调度</p>
</blockquote>
<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>为了提高处理速度，CPU不直接和内存进行通信，而是将系统内存的数据读到内部缓存（L1,L2,L3）后再操作，但操作完不确定何时会写回内存。这样可能导致其他CPU不能获取到共享变量的最新值。</p>
<h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><p>在x86处理器下通过工具获取JIT编译器生成的汇编指令来看看对Volatile进行写操作CPU</p>
<table>
<thead>
<tr>
<th>类别</th>
<th>代码</th>
</tr>
</thead>
<tbody>
<tr>
<td>Java代码</td>
<td><code>instance = new Singleton(); //instance是volatile变量</code></td>
</tr>
<tr>
<td>汇编指令</td>
<td><code>0x01a3de1d: movb $0x0,0x1104800(%esi);0x01a3de24: lock addl $0x0,(%esp);</code></td>
</tr>
</tbody>
</table>
<p><strong>Lock前缀的命令作两件事：</strong></p>
<ol>
<li>将当前CPU缓存行的数据写回到内存</li>
<li>令其他CPU里缓存了该内存地址的数据失效</li>
</ol>
<p><strong>缓存一致性协议</strong><br>每个CPU通过嗅探在总线中传播的数据来检查自己的缓存的值是否过期，当CPU发现自己缓存行对应的内存地址被修改，就会将当前处理器的缓存行设置成无效状态，当CPU对这个数据进行修改操作时，会重新从系统内存中把数据读到CPU缓存中。</p>
<h3 id="使用优化"><a href="#使用优化" class="headerlink" title="使用优化"></a>使用优化</h3><p>LinkedTransferQueue部分源码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** head of the queue */</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">final</span> PaddedAtomicReference &lt; QNode &gt; head;</div><div class="line"></div><div class="line"><span class="comment">/** tail of the queue */</span></div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">final</span> PaddedAtomicReference &lt; QNode &gt; tail;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PaddedAtomicReference</span> &lt; <span class="title">T</span> &gt; <span class="keyword">extends</span> <span class="title">AtomicReference</span> &lt; <span class="title">T</span> &gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// enough padding for 64bytes with 4byte refs </span></div><div class="line">    Object p0, p1, p2, p3, p4, p5, p6, p7, p8, p9, pa, pb, pc, pd, pe;</div><div class="line"></div><div class="line">    PaddedAtomicReference(T r) &#123;</div><div class="line"></div><div class="line">        <span class="keyword">super</span>(r);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicReference</span> &lt; <span class="title">V</span> &gt; <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> V value;</div><div class="line"></div><div class="line">    <span class="comment">//省略其他代码 ｝</span></div></pre></td></tr></table></figure></p>
<p>因为缓存行是64个字节且不支持部分填充缓存，这意味着，如果队头队尾不足64字节，有可能他们会读到同一个缓存行中，那么有可能在修改头结点时，会将整个缓存行锁定，使得其他CPU无法访问尾节点，导致效率低下。<br>在PaddedAtomicReference内部类中将共享变量追加到64字节，使得头结点和尾节点不会加载同一个缓存行，即不会互相锁定。</p>
<p><strong>不适合使用这种优化的情景</strong></p>
<ol>
<li>缓存行非64字节的CPU</li>
<li>共享变量不会被频繁地写</li>
</ol>
<h2 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h2><p><a href="http://www.cnblogs.com/paddix/p/5405678.html" target="_blank" rel="external">liuxiaopeng | Java并发编程：Synchronized底层优化（偏向锁、轻量级锁）
</a></p>
<h2 id="原子操作"><a href="#原子操作" class="headerlink" title="原子操作"></a>原子操作</h2><blockquote>
<p>不可被中断的一个或一系列操作</p>
</blockquote>
<h3 id="CPU实现原子操作"><a href="#CPU实现原子操作" class="headerlink" title="CPU实现原子操作"></a>CPU实现原子操作</h3><h4 id="总线锁定"><a href="#总线锁定" class="headerlink" title="总线锁定"></a>总线锁定</h4><p>使用CPU提供的一个LOCK#信号，当一个CPU在总线上输出此信号时，其他CPU的请求将会被阻塞，那么该CPU就能独享共享内存了</p>
<h4 id="缓存锁定"><a href="#缓存锁定" class="headerlink" title="缓存锁定"></a>缓存锁定</h4><p>内存区域如果被缓存在处理器的缓存行中，并且在Lock操作期间被锁定，那么当它执行锁操作回写到内存时，处理器不需要在总线上声言LOCK#信号，而是修改内部的内存地址，通过缓存一致性机制保证操作的原子性。<br>例外：当操作的数据不能被缓存在处理器内部，或操作的数据跨多个缓存行，处理器会调用总线锁定。或者处理器不支持缓存</p>
<h3 id="Java实现原子操作"><a href="#Java实现原子操作" class="headerlink" title="Java实现原子操作"></a>Java实现原子操作</h3><h4 id="循环CAS（CompareAndSet-CompareAndSwap）"><a href="#循环CAS（CompareAndSet-CompareAndSwap）" class="headerlink" title="循环CAS（CompareAndSet|CompareAndSwap）"></a>循环CAS（CompareAndSet|CompareAndSwap）</h4><p>jvm中的CAS操作是基于处理器的CMPXCHG指令实现的，CAS存在三个问题：</p>
<ol>
<li>ABA问题（解决：使用版本号A-B-A变成1A-2B-3A）</li>
<li>循环时间长开销大</li>
<li>只能保证一个共享变量的原子操作（解决：AtomicReference类将多个变量放到一个对象中进行CAS操作）</li>
</ol>
<h4 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h4><p>锁机制保证了只有获得锁的线程才能操作锁定的内存区域</p>

	
	</div>
  <a type="button" href="/2017/05/06/Java并发编程的艺术笔记/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/05/03/Hibernate缓存小结/" >Hibernate缓存小结</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-05-03  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="什么是缓存"><a href="#什么是缓存" class="headerlink" title="什么是缓存"></a>什么是缓存</h2><blockquote>
<p>缓存是介于应用程序和物理数据源之间，其作用是为了降低应用程序对物理数据源访问的频次，从而提高了应用的运行性能。缓存内的数据是对物理数据源中的数据的复制，应用程序在运行时从缓存读写数据，在特定的时刻或事件会同步缓存和物理数据源的数据。</p>
</blockquote>
<h2 id="一级缓存（会话级）"><a href="#一级缓存（会话级）" class="headerlink" title="一级缓存（会话级）"></a>一级缓存（会话级）</h2><ol>
<li>存放在session中，数据适用范围在当前session内</li>
<li>生命周期与当前session相同</li>
<li>默认启用</li>
<li>evict()方法：用于将某个对象从Session的一级缓存中清除</li>
<li>clear()方法：用于将一级缓存中的所有对象全部清楚</li>
</ol>
<h2 id="二级缓存（应用级）"><a href="#二级缓存（应用级）" class="headerlink" title="二级缓存（应用级）"></a>二级缓存（应用级）</h2><ol>
<li>数据可使用范围是当前应用的所有会话</li>
<li>默认不启用，选择性开启（默认是EHCache，其他二级缓存组件如：HashTable、OSCache、SwarmCache等。）</li>
<li>由sessionFactory控制</li>
</ol>
<h2 id="N-1次问题"><a href="#N-1次问题" class="headerlink" title="N+1次问题"></a>N+1次问题</h2><p>订单表(ORDERS)</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>ORDER_NUMBER</th>
<th>CUSTOMER_ID</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>TOM</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>TOM</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>JAY</td>
<td>2</td>
</tr>
<tr>
<td>4</td>
<td>ALICE</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>客户表(CUSTOMERS)</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>NAME</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>TOM</td>
</tr>
<tr>
<td>2</td>
<td>JAY</td>
</tr>
<tr>
<td>3</td>
<td>ALICE</td>
</tr>
</tbody>
</table>
<p>订单表和客户表是多对一的关系，当检索所有客户时<br>将依次执行以下SQL语句</p>
<blockquote>
<p>select <em> from CUSTOMERS;<br>select </em> from ORDERS where CUSTOMER_ID=1;<br>select <em> from ORDERS where CUSTOMER_ID=2;<br>select </em> from ORDERS where CUSTOMER_ID=3;</p>
</blockquote>
<h2 id="N-1问题解决方案"><a href="#N-1问题解决方案" class="headerlink" title="N+1问题解决方案"></a>N+1问题解决方案</h2><ol>
<li>使用表连接查询 <code>select * from CUSTOMERS left outer join ORDERS 
on CUSTOMERS.ID=ORDERS.CUSTOMER_ID</code></li>
<li>使用延迟加载 <code>fetch = FetchType.lazy</code></li>
<li>在关联对象类上标注<code>@BatchSize(size=x)</code> , 设置管理对象查询时一次性查询多少条记录， 使转为为 1+n/x问题。（不推荐）</li>
</ol>
<h2 id="适用二级缓存的情况"><a href="#适用二级缓存的情况" class="headerlink" title="适用二级缓存的情况"></a>适用二级缓存的情况</h2><ol>
<li>数据不会被第三方修改（绕过ORM会使数据不一致）</li>
<li>数据大小在可接收范围之内（缓存会占用内存资源，占太多反而会降低性能）</li>
<li>数据更新频率低（频繁的同步缓存中数据也会降低性能）</li>
<li>非关键数据（正确性 高于 高性能）</li>
</ol>
<h2 id="query-list（）和query-iterator（）"><a href="#query-list（）和query-iterator（）" class="headerlink" title="query.list（）和query.iterator（）"></a>query.list（）和query.iterator（）</h2><ol>
<li>list（）不使用一级缓存，即每次调用都会向底层数据库查询，但是会将结果保存到一级缓存中</li>
<li>iterator（）会先执行一条语句向数据库取出符合条件的数据id，然后通过id在hibernate的一级缓存中查找是否存在该对象，如果存在则直接取出，如果没有则再次发出一条sql语句通过id取得对象（并且加入到缓存中），这样如果所有的id在缓存中都没有的话就会出现n+1条sql语句的问题。</li>
</ol>

	
	</div>
  <a type="button" href="/2017/05/03/Hibernate缓存小结/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/03/30/可能会发生重定向的情况/" >可能会发生重定向的情况</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-03-30  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<a id="more"></a>
<h2 id="一-永久搬离的资源"><a href="#一-永久搬离的资源" class="headerlink" title="一. 永久搬离的资源"></a>一. 永久搬离的资源</h2><p>访问的资源被<strong>（永久性）移动新的位置</strong>或者被<strong>（永久性）重命名</strong>，从而形成新的URL。Web服务器返回重定向响应告诉客户从新的地址获取资源，并且在访问新地址之前更新书签之类的信息。</p>
<h2 id="二-临时搬离的资源"><a href="#二-临时搬离的资源" class="headerlink" title="二. 临时搬离的资源"></a>二. 临时搬离的资源</h2><p>访问的资源被<strong>临时移走</strong>或<strong>临时重命名</strong>，服务器希望客户端重定向到新的位置上去，但由于资源的改变是临时的，所以服务器希望客户端将来还是可以回头去使用老的URL。不要对书签进行更新</p>
<h2 id="三-URL增强"><a href="#三-URL增强" class="headerlink" title="三. URL增强"></a>三. URL增强</h2><p>通过重定向来重写URL，往往用于嵌入上下文。[经过扩展和状态增强的URL称为“胖URL”]<br>客户端会跟随这个重定向信息，重新发起请求，但这次的请求会包含完整的、经过状态增强的URL，这是在事务间维护状态的一种有效的方法。</p>
<h2 id="四-负载均衡"><a href="#四-负载均衡" class="headerlink" title="四. 负载均衡"></a>四. 负载均衡</h2><p>如果一个超载的服务器收到一条请求，服务器可以将客户端的请求重定向到一个负载不太重的服务器上去。</p>
<h2 id="五-规范目录名称"><a href="#五-规范目录名称" class="headerlink" title="五. 规范目录名称"></a>五. 规范目录名称</h2><p>客户端请求的URI是一个不带尾部斜线的目录吗时，大多数Web服务器会将客户端重定向到一个加了斜线的URI上，这样相对链接就可以正常工作了。</p>
<h2 id="补充：状态码302，303，307的区别"><a href="#补充：状态码302，303，307的区别" class="headerlink" title="补充：状态码302，303，307的区别"></a>补充：状态码302，303，307的区别</h2><ul>
<li>302是HTTP/1.0的标准，303，307则是HTTP/1.1标准中对302的细化</li>
<li>302：如果客户端发出POST请求后，收到服务端的302状态码，那么不能自动的向新的URI发送重复请求，必须跟用户确认是否该重发，因为第二次POST时，环境可能已经发生变化（POST方法不是幂等的），POST操作会不符合用户预期</li>
<li>303：对于POST请求，它表示请求已经被处理，客户端可以接着使用GET方法去请求Location里的URI</li>
<li>307：对于POST请求，表示请求还没有被处理，客户端应该向Location里的URI重新发起POST请求</li>
</ul>

	
	</div>
  <a type="button" href="/2017/03/30/可能会发生重定向的情况/#more" class="btn btn-default more">阅读此文</a>
</div>

		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">

   
    
           <a type="button" class="btn btn-default disabled"><i class="fa fa-arrow-circle-o-left"></i>上一页</a>
        

        <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
 
       <a href="/page/2/" type="button" class="btn btn-default ">下一页<i class="fa fa-arrow-circle-o-right"></i></a>     
        

  
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			
  <div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" name="q" results="0" placeholder="搜索" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div>


		
			
		
			
	<div class="widget">
		<h4>标签云</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/杂/">杂<span>2</span></a></li>
		
			<li><a href="/tags/笔记/">笔记<span>1</span></a></li>
		
			<li><a href="/tags/RMQ/">RMQ<span>1</span></a></li>
		
			<li><a href="/tags/欧拉图/">欧拉图<span>1</span></a></li>
		
			<li><a href="/tags/LeetCode/">LeetCode<span>10</span></a></li>
		
			<li><a href="/tags/CodeVs/">CodeVs<span>3</span></a></li>
		
			<li><a href="/tags/尺取法/">尺取法<span>1</span></a></li>
		
			<li><a href="/tags/review/">review<span>2</span></a></li>
		
			<li><a href="/tags/Django-REST-framework/">Django REST framework<span>2</span></a></li>
		
			<li><a href="/tags/数据库/">数据库<span>3</span></a></li>
		
			<li><a href="/tags/MVC/">MVC<span>1</span></a></li>
		
			<li><a href="/tags/CodeForces/">CodeForces<span>7</span></a></li>
		
			<li><a href="/tags/KMP/">KMP<span>1</span></a></li>
		
			<li><a href="/tags/Django-RESTful-framewo/">Django RESTful framewo<span>1</span></a></li>
		
			<li><a href="/tags/mysql/">mysql<span>1</span></a></li>
		
			<li><a href="/tags/HDU/">HDU<span>2</span></a></li>
		
			<li><a href="/tags/Java并发/">Java并发<span>1</span></a></li>
		
			<li><a href="/tags/并查集/">并查集<span>1</span></a></li>
		
			<li><a href="/tags/最短路径/">最短路径<span>1</span></a></li>
		
			<li><a href="/tags/数据结构/">数据结构<span>2</span></a></li>
		
		
		   <li><a href="/tags">...<span>35</span></a></li>
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>最新文章</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2018/02/08/Django-REST-framework-教程2：请求和响应/" ><i class="fa fa-file-o"></i>Django REST framework 教程2：请...</a>
      </li>
    
      <li>
        <a href="/2018/02/07/Django-RESTful-framework教程1：序列化/" ><i class="fa fa-file-o"></i>Django REST framework教程1：序列化</a>
      </li>
    
      <li>
        <a href="/2018/02/06/Django-RESTful-framework快速入门/" ><i class="fa fa-file-o"></i>Django RESTful framework快速入门</a>
      </li>
    
      <li>
        <a href="/2018/01/07/数据库建模/" ><i class="fa fa-file-o"></i>数据库建模</a>
      </li>
    
      <li>
        <a href="/2017/05/21/乐观锁-悲观锁/" ><i class="fa fa-file-o"></i>乐观锁-悲观锁</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>链接</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="fa fa-github"></i><a href="https://github.com/HeyZOJian" title="My Github account." target="_blank"]);">My Github</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->
	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2018 John Doe
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a>,<a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>,<a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a> and <a href="http://getbootstrap.com/" target="_blank">BOOTSTRA.386</a>. 
     <br> Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind.386</a>.    
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
